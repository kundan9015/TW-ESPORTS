{% extends "base.html" %}

{% block title %}Bulk Match Upload{% endblock %}

{% block content %}
<h1 class="neon-title mb-4">ðŸ“¤ Bulk Match Upload (Admin)</h1>

<div class="row">
  <div class="col-lg-5">
    <div class="glass-card">
      <h3 class="neon-title mb-3">Match Info & Screenshot</h3>
      <form id="bulkForm" method="POST" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="date" class="form-label">Date</label>
          <input type="date" class="form-control" id="date" name="date" required>
        </div>

        <div class="mb-3">
          <label for="match_type" class="form-label">Mode / Match Type</label>
          <select class="form-select" id="match_type" name="match_type" required>
            <option value="BR">BR</option>
            <option value="CS">CS</option>
            <option value="Scrims">Scrims</option>
            <option value="Custom">Custom</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Single Screenshot (all players)</label>
          <input type="file" class="form-control" id="screenshot" name="screenshot" required>
          <div class="muted small mt-1">This image will be linked to all players in this match.</div>
        </div>

        <button type="submit" class="btn-neon w-100 mt-2">âœ… Save All Records</button>
      </form>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="glass-card">
      <h3 class="neon-title mb-3">Players in this Match</h3>
      <div class="muted small mb-2">Add one row per player using this screenshot.</div>

      <div class="table-responsive">
        <table class="table table-sm align-middle" style="font-size: 13px;">
          <thead>
            <tr style="color: var(--accent-primary);">
              <th>Player</th>
              <th style="width: 70px; text-align:right;">Kills</th>
              <th style="width: 80px; text-align:right;">Pos (1â€“12)</th>
              <th style="width: 90px; text-align:right;">Damage</th>
              <th style="width: 90px; text-align:right;">Survival</th>
              <th style="width: 40px;"></th>
            </tr>
          </thead>
          <tbody id="playerRows">
          </tbody>
        </table>
      </div>

      <button type="button" class="btn btn-outline-success btn-sm" onclick="addRow()">ï¼‹ Add Player Row</button>
    </div>
  </div>
</div>

<script>
  const players = {{ players|tojson }};

  function addRow() {
    const tbody = document.getElementById('playerRows');
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td>
        <select name="player_id" class="form-select form-select-sm" required>
          <option value="">Select playerâ€¦</option>
          ${players.map(p => `<option value="${p.id}">${p.username}</option>`).join('')}
        </select>
      </td>
      <td>
        <input type="number" name="kills" class="form-control form-control-sm" min="0" value="0" style="text-align:right;">
      </td>
      <td>
        <input type="number" name="position" class="form-control form-control-sm" min="1" max="12" value="1" style="text-align:right;">
      </td>
      <td>
        <input type="number" name="damage" class="form-control form-control-sm" min="0" value="0" style="text-align:right;">
      </td>
      <td>
        <input type="number" name="survival" class="form-control form-control-sm" min="0" value="0" style="text-align:right;">
      </td>
      <td>
        <button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest('tr').remove()">âœ•</button>
      </td>
    `;

    tbody.appendChild(tr);
  }

  // add a couple of rows by default for convenience
  addRow();
  addRow();
</script>
{% endblock %}

