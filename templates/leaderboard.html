{% extends "base.html" %}

{% block title %}Leaderboard{% endblock %}

{% block head %}
<script src="{{ url_for('static', filename='js/leaderboard.js') }}"></script>
{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
  <div>
    <h1 class="neon-title mb-1">üèÜ Tournament Leaderboard</h1>
    <p class="muted small mb-0">
      Mode:
      {% set mode = match_type or 'overall' %}
      <span style="color: var(--accent-primary); font-weight: 600; text-transform: uppercase;">{{ 'Overall' if mode == 'overall' else mode }}</span>
    </p>
  </div>
  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
    <select id="lbMode" class="form-select form-select-sm" style="min-width:120px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04); color:#e6eef6;">
      {% set mode = match_type or 'overall' %}
      <option value="overall" {% if mode=='overall' %}selected{% endif %}>Overall</option>
      <option value="BR" {% if mode=='BR' %}selected{% endif %}>BR</option>
      <option value="CS" {% if mode=='CS' %}selected{% endif %}>CS</option>
      <option value="Scrims" {% if mode=='Scrims' %}selected{% endif %}>Scrims</option>
      <option value="Custom" {% if mode=='Custom' %}selected{% endif %}>Custom</option>
    </select>
    <input id="tableSearch" type="text" class="form-control form-control-sm" placeholder="Search players..." style="max-width: 200px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04); color: #e6eef6;">
  </div>
</div>

<div class="glass-card">
  <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: separate; border-spacing: 0 8px;">
      <thead>
        <tr style="color: var(--accent-primary); text-align: left; font-weight: 700;">
          <th style="padding: 12px; width: 60px;">Rank</th>
          <th style="padding: 12px;">Player</th>
          <th style="padding: 12px; text-align: right;">Kills</th>
          <th style="padding: 12px; text-align: right;">Wins</th>
          <th style="padding: 12px; text-align: right;">Damage</th>
          <th style="padding: 12px; text-align: right;">Survival</th>
          <th style="padding: 12px; text-align: right;">Score</th>
        </tr>
      </thead>
      <tbody id="board">
        {% for player in board %}
        <tr class="{% if loop.index==1 %}gold{% elif loop.index==2 %}silver{% elif loop.index==3 %}bronze{% endif %}" style="background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border-radius: 8px; transition: all .12s ease;">
          <td style="padding: 12px; border-radius: 8px 0 0 8px;">
            <span class="rank-badge {% if loop.index==1 %}gold{% elif loop.index==2 %}silver{% elif loop.index==3 %}bronze{% endif %}">{{ loop.index }}</span>
          </td>
          <td style="padding: 12px;">
            <a href="/player/{{ player.name }}" style="color: var(--text-secondary); text-decoration: none; font-weight: 600; transition: color .12s ease;">{{ player.name }}</a>
          </td>
          <td style="padding: 12px; text-align: right; {% if loop.index==1 %}color: var(--accent-primary); font-weight: 700;{% elif loop.index==2 %}color: var(--cyan-glow); font-weight: 700;{% elif loop.index==3 %}color: var(--gold); font-weight: 700;{% endif %}">{{ player.kills }}</td>
          <td style="padding: 12px; text-align: right; {% if loop.index==1 %}color: var(--gold); font-weight: 700;{% elif loop.index==2 %}color: var(--gold); font-weight: 600;{% elif loop.index==3 %}color: var(--gold); font-weight: 600;{% else %}color: var(--gold);{% endif %}">{{ player.booyah }}</td>
          <td style="padding: 12px; text-align: right; {% if loop.index==1 %}color: var(--accent-primary); font-weight: 600;{% elif loop.index==2 %}color: var(--cyan-glow); font-weight: 600;{% elif loop.index==3 %}color: var(--gold); font-weight: 600;{% endif %}">{{ player.damage }}</td>
          <td style="padding: 12px; text-align: right; {% if loop.index==1 %}color: var(--accent-primary); font-weight: 600;{% elif loop.index==2 %}color: var(--cyan-glow); font-weight: 600;{% elif loop.index==3 %}color: var(--gold); font-weight: 600;{% endif %}">{{ player.survival }}</td>
          <td style="padding: 12px; text-align: right; border-radius: 0 8px 8px 0; color: var(--accent-primary); font-weight: 700;">{{ player.score }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="muted small" style="margin-top: 12px; text-align: center;">Score = kills + position points + damage/1000 + 0.2√ósurvival</div>
</div>

<style>
  .rank-badge {
    width: 36px;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-weight: 700;
    font-size: 14px;
  }
  .gold {
    background: linear-gradient(90deg, #ffd54a, #ffb74d);
    color: #111;
    box-shadow: 0 8px 30px rgba(255, 181, 33, 0.12);
  }
  .silver {
    background: linear-gradient(90deg, #cfcfcf, #e6e6e6);
    color: #111;
    box-shadow: 0 8px 30px rgba(200, 200, 200, 0.08);
  }
  .bronze {
    background: linear-gradient(90deg, #c27a4b, #b06a3b);
    color: #fff;
    box-shadow: 0 8px 30px rgba(180, 110, 60, 0.08);
  }
  #board tr:hover {
    background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.04)) !important;
    transform: translateX(4px);
  }
</style>

<script>
// Search/filter
const searchInput = document.getElementById('tableSearch');
if (searchInput) {
  searchInput.addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase();
    document.querySelectorAll('#board tr').forEach((row) => {
      const name = row.cells[1].textContent.toLowerCase();
      row.style.display = name.includes(term) ? '' : 'none';
    });
  });
}

// Mode filter (server-side via ?type=)
const lbMode = document.getElementById('lbMode');
if (lbMode) {
  lbMode.addEventListener('change', (e) => {
    const val = e.target.value || 'overall';
    const base = window.location.pathname;
    const params = new URLSearchParams(window.location.search);
    params.set('type', val);
    window.location = base + '?' + params.toString();
  });
}
</script>
{% endblock %}
